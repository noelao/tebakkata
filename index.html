<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.svg" type="image/x-icon">
    <title>Xixixi...</title>
    <style>
        :root {
            --gelap : #1B1C1D;
            --terang : #fafafa;
            --terangSemu : color-mix(in oklab, #fafafa, transparent 20%);
        }
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        .container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background-color: var(--gelap);
            
        }
        .skor {
            width: 16rem;
            h2 {
                color: var(--terang);
            }
        }
        .wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            .clue {
                width: 100%;
                margin-bottom: 1rem;
                max-width: 16rem;
                h2 {
                    color: var(--terang);
                }
            }
            .barisHuruf {
                display: flex;
                .kotakHuruf {
                    height: 5rem;
                    width: 5rem;

                    border: none;
                    border-top:solid var(--terang) 3px;
                    border-left:solid var(--terang) 3px;
                    background-color: transparent;
                    align-items: center;
                    justify-content: center;
                    color: var(--terang);
                    text-align: center;

                    font-size: 4rem;
                    outline: none;
                    transition: background-color .5s ease;
                }
                .kotakHuruf:last-child {
                    border-right:solid var(--terang) 3px;
                }
            }
            .barisHuruf:last-child {
                .kotakHuruf {
                    border-bottom:solid var(--terang) 3px;
                }
            }
        }
        .popup {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);

            height: 12rem;
            width: 23rem;
            background-color: var(--terangSemu);

            transition: transform .3s ease;

            color: var(--gelap);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 1rem;
            gap: 2rem;
            .tombolLanjut {
                padding: 0 1rem;
                background-color: var(--gelap);
                color: var(--terang);
                font-size: 2rem;
                cursor: pointer;
            }
        }
        .popup.muncul {
            transform: translateX(-50%) translateY(0);
        }

        @media screen and (max-width : 376px){
            .wrapper {
                display: grid;
                /* grid-template-rows: repeat(1, 3rem); */
                .barisHuruf {
                    .kotakHuruf {
                        height: 4rem;
                        width: 4rem;
                        font-size: 3rem;
                        aspect-ratio: 1;
                    }
                }
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="skor">
            <h2></h2>
        </div>
        <div class="wrapper">
        </div>
        <div class="popup">
            <h2></h2>
        </div>
    </div>
<script>
    let data = [];

    let skorBenar = 0;

    ambilKata();
    tambahSkor();

    function tambahSkor(){
        document.querySelector(".skor h2").textContent = "skor : "+skorBenar;
        skorBenar += 1;
    }

    const wrapper = document.querySelector(".wrapper");

    async function ambilKata() {
        try {
            const response = await fetch("./data.json");
            const ini = await response.json();
            data = ini;
            
        } catch (err){
            console.log(err);
        } finally {
            const xColumn = Math.round(Math.random() * (data.length-1 - 0) + 0);

            const xHuruf = data[xColumn].jumlahHuruf;
            
            const xKe = Math.round(Math.random() * ((data[xColumn].benda.length-1) - 0) + 0);

            const clueDiv = document.createElement('div');
            clueDiv.className = "clue";
            const h2Clue = document.createElement('h2');
            h2Clue.innerHTML = data[xColumn].clue;
            clueDiv.appendChild(h2Clue);
            wrapper.appendChild(clueDiv);

            
            const jawaban = data[xColumn].benda[xKe].map(ini=>{
                return ini;
            }).join("");


            for (let i = 0; i < 5; i++){
                const barisHuruf = document.createElement('div');
                barisHuruf.className = "barisHuruf";

                for (let g = 0; g < xHuruf; g++){
                    const kotakHuruf = document.createElement('input');
                    kotakHuruf.type = 'text';
                    kotakHuruf.setAttribute('maxlength', '1');
                    kotakHuruf.className = "kotakHuruf";

                    barisHuruf.appendChild(kotakHuruf);
                }
                
                wrapper.appendChild(barisHuruf);
            }


            let arrJawab = new Array(xHuruf).fill("-");

            // checkJawabanColom(data, xColumn, xKe, arrJawab);


            // gap so big

            
            const inputs = wrapper.querySelectorAll('input');

            
            let cekBerhasil = new Array(xHuruf).fill(false);
            inputs[0].focus();
            inputs.forEach((input, index) => {
                
                // 1. Event Listener untuk Otomatis Pindah
                input.addEventListener('input', () => {
                    const nextInput = inputs[index + 1];

                    const iBaris = index % xHuruf;

                    // Cek apakah input sudah terisi dan ada input berikutnya
                    if (input.value.length === 1) {
                        arrJawab[iBaris] = input.value;

                        if(nextInput){
                            nextInput.focus();
                        } else {
                            lakukanPopup(("jawaban yang benar adalah " + jawaban));
                        }
                    }

                    if(iBaris == xHuruf-1){
                        checkJawabanColom(data, xColumn, xKe, arrJawab, parseInt(index), inputs, xHuruf);
                        cekBerhasil = new Array(xHuruf).fill(false)
                        console.log("array di perbaharui jadi false semua");
                    }

                });

                // 2. (Opsional) Event Listener untuk Hapus (Backspace)
                // Ini meningkatkan pengalaman pengguna (UX) agar bisa pindah mundur
                input.addEventListener('keydown', (event) => {
                    const prevInput = inputs[index - 1];

                    // Cek jika tombol yang ditekan adalah Backspace atau Delete
                    if ((event.key === 'Backspace' || event.key === 'Delete') && input.value.length === 0 && prevInput) {
                        prevInput.focus();
                    }
                });

                // 3. (Opsional) Pastikan Input Hanya Angka/Huruf
                // Mencegah pengguna menempel (paste) string panjang
                input.addEventListener('paste', (event) => {
                    event.preventDefault();
                    const pasteData = event.clipboardData.getData('text').trim();
                    
                    // Loop dan isi semua input jika string yang ditempel panjang
                    for (let i = 0; i < pasteData.length && index + i < inputs.length; i++) {
                        inputs[index + i].value = pasteData[i];
                    }
                    
                    // Pindahkan fokus ke input terakhir yang diisi
                    if (index + pasteData.length < inputs.length) {
                        inputs[index + pasteData.length].focus();
                    } else {
                        inputs[inputs.length - 1].focus(); // Fokus ke yang terakhir
                    }
                });

            });

        }
    }

    function lakukanPopup(kata){
        const popup = document.querySelector(".popup");
        popup.innerHTML = "";
        popup.classList.add("muncul");
        
        const kalimat = document.createElement("h2");
        kalimat.textContent = kata;
        popup.appendChild(kalimat);
        
        const tombol = document.createElement("div");
        tombol.className = "tombolLanjut";
        tombol.textContent = "lanjut";
        tombol.addEventListener("click", function(){
            popup.classList.remove("muncul");
            wrapper.innerHTML = "";
            ambilKata();
            tambahSkor();
        })

        popup.appendChild(tombol);

    }

    function checkJawabanColom(data, xColumn, xKe, arrJawab, indexInput, inputs, xHuruf){
        const kunci = data[xColumn].benda[xKe]
        console.log(arrJawab);
        console.log(kunci);


        // cek apakah kata benar
        kunci.some((ini, i)=>{
            if(ini == arrJawab[i]){
                if(i == arrJawab.length-1){
                    lakukanPopup("tahniah teman, kau dah berjaya menebaknye");
                    // location.reload();
                }
            } else {
                return true;
            }
        });

        let warnaInput = new Array(arrJawab.length).fill("hitam");
        let jumlahHuruf = {};
        
        // cek apakah ada huruf yng double dan tambahkan ke list
        kunci.forEach((ini, i)=>{
            if(jumlahHuruf[ini]){
                jumlahHuruf[ini] = jumlahHuruf[ini] + 1
            } else {
                jumlahHuruf[ini] = 1
            }
        })

        
        // cek apakah huruf benar dikolom itu
        arrJawab.forEach((ini, i)=>{
            if(ini == kunci[i]){
                jumlahHuruf[ini] -= jumlahHuruf[ini];
                warnaInput[i] = "hijau";
            } else {
                warnaInput[i] = "gelap";
            }
        });
        console.log(warnaInput);
        console.log(jumlahHuruf);

        // cek apakah huruf benar dikolom bebas
        arrJawab.forEach((ini, i)=>{
            kunci.some((lagi, p)=>{
                if(lagi == ini){
                    if(jumlahHuruf[ini] == 0){
                        if(i == p){
                            warnaInput[i] = "hijau";
                            return true;
                        } else {
                            warnaInput[i] = "gelap"
                        }
                    } else {
                        jumlahHuruf[ini] -= jumlahHuruf[ini];
                        warnaInput[i] = "semu"
                        return true;
                    }
                } else {
                }
            });
        });

        console.log(warnaInput);
        console.log(jumlahHuruf);

        // terapkan array dan warnai inputs
        warnaInput.forEach((ini, i)=>{
            console.log(indexInput - (xHuruf-1) +parseInt(i));
            if(ini == "terang"){
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.backgroundColor = "var(--terang)";
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.color = "var(--gelap)";
            } else if(ini == "semu"){
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.backgroundColor = "#ccc";
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.color = "var(--terang)";
            } else if(ini == "hijau"){
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.backgroundColor = "green";
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.color = "var(--terang)";
            } else {
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.backgroundColor = "#0a0a0a";
                inputs[indexInput - (xHuruf-1) +parseInt(i)].style.color = "var(--terang)";
            }
        })


    }
    
</script>
</body>
</html>